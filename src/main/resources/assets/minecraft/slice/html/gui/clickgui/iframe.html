<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@1.0.0/dist/css/mdui.min.css"
        integrity="sha384-2PJ2u4NYg6jCNNpv3i1hK9AoAqODy6CdiC+gYiL2DVx+ku5wzJMFNdE3RoWfBIRP" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/mdui@1.0.0/dist/js/mdui.min.js"
        integrity="sha384-aB8rnkAu/GBsQ1q6dwTySnlrrbhqDwrDnpVHR2Wgm8pWLbwUnzDcIROX3VvCbaK+"
        crossorigin="anonymous"></script>
    <style>
        ::-webkit-scrollbar {
            display: none;
        }

        body {
            -webkit-user-select: none;
        }

        /* center all items of .settings-row vertically */
        .settings-row {
            margin-top: 30px;
            transition: translateY(-50%);
        }

        h3 {
            top: 0;
            display: inline-block;
            margin: 0;
        }

        body .mdui-drawer {
            -webkit-transition: all .3s cubic-bezier(0, 0, .2, 1);
            transition: all .3s cubic-bezier(0, 0, .2, 1);
        }
    </style>
</head>

<body
    class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-indigo mdui-theme-accent-pink mdui-theme-layout-auto">
    <div id="box">
        <header class="appbar mdui-appbar mdui-appbar-fixed" id="boxheader">
            <div class="mdui-toolbar mdui-color-theme">
                <span class="mdui-btn mdui-btn-icon mdui-ripple mdui-ripple-white"
                    mdui-drawer="{target: '#main-drawer', swipe: true}">
                    <i class="mdui-icon material-icons">menu</i>
                </span>
                <a class="mdui-typo-headline mdui-hidden-xs">Slice<span style="visibility: hidden;">asdfasdf</span></a>
                <div class="mdui-toolbar-spacer"></div>
                <div class="mdui-textfield mdui-textfield-expandable">
                    <button class="mdui-textfield-icon mdui-btn mdui-btn-icon">
                        <i class="mdui-icon material-icons">search</i>
                    </button>
                    <input class="mdui-textfield-input" id="search" type="text" placeholder="Search" />
                    <button class="mdui-textfield-close mdui-btn mdui-btn-icon">
                        <i class="mdui-icon material-icons">close</i>
                    </button>
                </div>
                <span class="mdui-btn mdui-btn-icon mdui-ripple mdui-ripple-white"
                    mdui-tooltip="{content: 'Close the ClickGUI.'}">
                    <i class="mdui-icon material-icons">close</i>
                </span>
            </div>
        </header>

        <div class="mdui-drawer" id="main-drawer">
            <div class="mdui-list" mdui-collapse="{accordion: true}" style="margin-bottom: 76px;">
                <div class="
                mdui-collapse-item
                combat
                ">
                    <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                        <div class="mdui-list-item-content">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">Combat</font>
                            </font>
                        </div>
                        <i class="mdui-collapse-item-arrow mdui-icon material-icons">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">keyboard_arrow_down</font>
                            </font>
                        </i>
                    </div>
                </div>
                <div class="
                mdui-collapse-item
                movement
                ">
                    <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                        <div class="mdui-list-item-content">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">Movement</font>
                            </font>
                        </div>
                        <i class="mdui-collapse-item-arrow mdui-icon material-icons">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">keyboard_arrow_down</font>
                            </font>
                        </i>
                    </div>
                </div>
                <div class="
                mdui-collapse-item
                player
                ">
                    <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                        <div class="mdui-list-item-content">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">Player</font>
                            </font>
                        </div>
                        <i class="mdui-collapse-item-arrow mdui-icon material-icons">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">keyboard_arrow_down</font>
                            </font>
                        </i>
                    </div>
                </div>
                <div class="
                mdui-collapse-item
                world
                ">
                    <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                        <div class="mdui-list-item-content">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">World</font>
                            </font>
                        </div>
                        <i class="mdui-collapse-item-arrow mdui-icon material-icons">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">keyboard_arrow_down</font>
                            </font>
                        </i>
                    </div>
                </div>
                <div class="
                mdui-collapse-item
                render
                ">
                    <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                        <div class="mdui-list-item-content">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">Render</font>
                            </font>
                        </div>
                        <i class="mdui-collapse-item-arrow mdui-icon material-icons">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">keyboard_arrow_down</font>
                            </font>
                        </i>
                    </div>
                </div>
                <div class="
                mdui-collapse-item
                misc
                ">
                    <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                        <div class="mdui-list-item-content">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">Misc</font>
                            </font>
                        </div>
                        <i class="mdui-collapse-item-arrow mdui-icon material-icons">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">keyboard_arrow_down</font>
                            </font>
                        </i>
                    </div>
                </div>
            </div>
        </div>

        <div class="shown-module mdui-list"></div>

    </div>

    <script>
        const Modules = {
            Combat: {},
            Movement: {},
            Player: {},
            World: {},
            Render: {},
            Misc: {}
        }

        const ModuleLocation = {}

        function addModule(category, name) {
            if (Modules[category][name]) return;

            const module = document.createElement("div");
            module.classList.add("mdui-collapse-item-body");
            module.classList.add("mdui-list");
            module.id = name;
            module.innerHTML = `
            <a class="
                    mdui-list-item
                    mdui-ripple
                    ">
                <label class="mdui-checkbox">
                    ${name}
                    <input type="checkbox" />
                    <i class="mdui-checkbox-icon"></i>
                </label>
            </a>
            `;
            document.querySelector(`.${category.toLowerCase()}`).appendChild(module);
            module.onclick = function () { showModule(name) };
            module.querySelector("input").onchange = function() {
                window.cefQuery({
                    request: `${name.replaceAll(" ", "")} ${this.checked ? "true" : "false"}`,
                    persistent: false,
                });
            }
            Modules[category][name] = {
                enabled: false,
                querySelector: document.querySelector(`#${name}`),
                settings: {},
            }
            ModuleLocation[name] = Modules[category][name];
        }

        function updateSetting(module, setting, type, value) {
            if(!ModuleLocation[module].settings[setting]) return;

            switch (type) {
                case "NumberValue":
                    ModuleLocation[module].settings.value = parseFloat(value);
                    break;
                case "BooleanValue":
                    ModuleLocation[module].settings.value = value;
                    break;
                case "ModeValue":
                    ModuleLocation[module].settings.value = value;
                    break;
            }
        }

        function setEnabled(name, enabled) {
            if (!ModuleLocation[name]) return;
            ModuleLocation[name].enabled = enabled;
            ModuleLocation[name].querySelector.querySelector("input").checked = enabled;
        }

        function showModule(name) {
            if (!ModuleLocation[name]) return;
            const moduleSettings = document.createElement("div");
            moduleSettings.classList.add("container", "p-selection_control", "mdui-container");
            moduleSettings.innerHTML = `
            <h1 class="title mdui-text-color-theme">
                <font style="vertical-align: inherit;">
                    <font style="vertical-align: inherit;">${name}</font>
                </font>
            </h1>`;

            Object.entries(ModuleLocation[name].settings).forEach(([key, value]) => {
                if(!value.hidden) {
                    switch (value.type) {
                        case "BooleanValue":
                            const booleanDiv = document.createElement("div");
                            booleanDiv.classList.add(key.replace(/ /g, "-"), "settings-row");
                            booleanDiv.innerHTML = `
                        <div>
                        <h3>${key}</h3>
                        <label class="mdui-checkbox" style="position: relative; margin-left: auto; margin-right: 0; float: right;">
                            <input id="${name}-${key}-${value.type}" type="checkbox" ${value.value ? "checked" : ""} />
                            <i class="mdui-checkbox-icon"></i>
                        </label>
                        </div>
                        `;
                            moduleSettings.appendChild(booleanDiv);

                            break;
                        case "NumberValue":
                            const numberDiv = document.createElement("div");
                            numberDiv.classList.add(key.replace(/ /g, "-"), "settings-row");
                            numberDiv.innerHTML = `
                        <h3>${key}</h3>
                        <label class="mdui-slider mdui-slider-discrete">
                            <input id="${name}-${key}-${value.type}" type="range" value="${value.value}" step="0.01" min="${value.min}" max="${value.max}" onchange="function change() {console.log(this)}"/>
                        </label>
                        `;
                            moduleSettings.appendChild(numberDiv);
                            break;
                        case "ModeValue":
                            const modeDiv = document.createElement("div");
                            modeDiv.classList.add(key.replace(/ /g, "-"), "settings-row");
                            const select = document.createElement("select");
                            select.classList.add("mdui-select");
                            select.setAttribute("mdui-select", "{position: 'bottom'}");
                            select.style = "position: relative; margin-left: auto; margin-right: 0px; float: right; display: none;"
                            select.id = `${name}-${key}-${value.type}`;
                            const h3 = document.createElement("h3");
                            h3.innerText = key;
                            modeDiv.appendChild(h3);

                            for (const option of value.options) {
                                select.innerHTML += `<option ${value.value == option ? "selected" : ""} value="${value.options.indexOf(option)}">${option}</option>`;
                            }

                            modeDiv.appendChild(select);
                            moduleSettings.appendChild(modeDiv);
                    }
                }
            });
            document.querySelector(".shown-module").innerHTML = moduleSettings.outerHTML;
            mdui.mutation();
        }

        document.querySelector("#search").addEventListener('keydown', (e) => {
            document.querySelector(".shown-module").innerHTML = "<h1>No module found.</h1>";
            for (const module in ModuleLocation) {
                if (module.toLowerCase().includes(e.target.value.toLowerCase())) {
                    if (document.querySelector(".shown-module").innerHTML == "<h1>No module found.</h1>") {
                        document.querySelector(".shown-module").innerHTML = "";
                    }
                    const searchModule = document.createElement("div");
                    searchModule.id = name;
                    searchModule.innerHTML = `
                    <label class="mdui-checkbox">
                        <h1>
                            ${module}
                        </h1>
                    </label>`;
                    document.querySelector(`.shown-module`).appendChild(searchModule);
                    searchModule.onclick = function () { showModule(module) };
                    mdui.mutation();
                }
            }
        });

        function hideSetting(module, setting, hide) {
            ModuleLocation[module].settings[setting].hidden = hide;
        }

        function getModule(module, state) {
            return ModuleLocation[module].checked = state;
        }

        function updateBooleanValue(module, setting, value) {
            if(ModuleLocation[module].settings[setting].type !== "BooleanValue") return;

            ModuleLocation[module].settings[setting].value = value;
        }

        function addSettingToModule(name, type, ...args) {
            if (!ModuleLocation[name]) return;
            const settingName = args[0];
            const defaultValue = args[1];
            switch (type) {
                case "BooleanValue":
                    ModuleLocation[name].settings[settingName] = {
                        hidden: false,
                        type: "BooleanValue",
                        value: defaultValue,
                    };
                    break;
                case "ModeValue":
                    args.splice(0, 2);
                    let options = [...args];
                    ModuleLocation[name].settings[settingName] = {
                        hidden: false,
                        type: "ModeValue",
                        value: defaultValue,
                        options: options,
                    };
                    break;
                case "NumberValue":
                    let min = args[2];
                    let max = args[3];
                    ModuleLocation[name].settings[settingName] = {
                        hidden: false,
                        type: "NumberValue",
                        value: defaultValue,
                        min: min,
                        max: max,
                    };
                    break;
            }
        }

        document.addEventListener("change", (e) => {
            if (!e.target.id) return;
            let name = e.target.id.split("-")[0];
            if (!ModuleLocation[name]) return;
            let setting = e.target.id.split("-")[1];
            if (!ModuleLocation[name].settings[setting]) return;
            let type = e.target.id.split("-")[2];
            if (type !== ModuleLocation[name].settings[setting].type) return;
            switch (type) {
                case "BooleanValue":
                    ModuleLocation[name].settings[setting].value = e.target.checked;
                    window.cefQuery({
                        request: name + " " + setting.replaceAll(" ", "") + " " + e.target.checked,
                        persistent: false,
                    });
                    showModule(name);
                    break;
                case "NumberValue":
                    ModuleLocation[name].settings[setting].value = parseFloat(e.target.value);
                    window.cefQuery({
                        request: name + " " + setting.replaceAll(" ", "") + " " + e.target.value,
                        persistent: false,
                    });
                    showModule(name);
                    break;
                case "ModeValue":
                    ModuleLocation[name].settings[setting].value = e.target.options[e.target.selectedIndex].text;
                    window.cefQuery({
                        request: name + " " + setting.replaceAll(" ", "") + " " + e.target.options[e.target.selectedIndex].text,
                        persistent: false,
                    });
                    showModule(name);
                    break;
            }
        });

        document.querySelector("#boxheader > div > span:nth-child(5)").addEventListener("click", () => {
            window.cefQuery({
                request: "CloseGui",
                persistent: false,
            });
        });

        window.cefQuery({
            request: 'Init',
            persistent: false,
        });
    </script>

</body>

</html>